import{a as pt}from"./chunk-7LX5S6I5.js";import{b as H,e as Z,g as J,i as W,k as X,n as Y,p as $,q as tt}from"./chunk-7MSBYUED.js";import{a as G}from"./chunk-6CEW7SB3.js";import{a as it,b as ot,c as rt}from"./chunk-OTHZSRBL.js";import{$ as nt,_ as et}from"./chunk-7K4UIWI7.js";import"./chunk-SWYALDXR.js";import{b as Q}from"./chunk-DDJNJVRK.js";import{b as L,i as j,j as R,k as z,n as q,w as U}from"./chunk-I6AKDVZX.js";import{Eb as C,Gb as m,Jb as T,Lb as w,Na as F,Rb as k,Sb as D,Tb as E,Ub as P,Xb as K,Yb as A,Z as N,Za as h,_a as u,_b as B,bb as V,ea as y,fa as b,ha as O,hb as a,ja as d,ka as g,lb as _,nb as I,tb as f,ub as p,vb as M,zb as S}from"./chunk-QYKYBBAS.js";import{d as at}from"./chunk-JCXCEWRH.js";function ut(r,i){if(r&1){let t=S();f(0,"input",3,4),C("paste",function(e){d(t);let o=m(2);return g(o.handlePaste(e))})("keyup",function(e){let s=d(t).index,l=m(2);return g(l.onKeyUp(e,s))})("input",function(e){d(t);let o=m(2);return g(o.onInput(e))})("keydown",function(e){let s=d(t).index,l=m(2);return g(l.onKeyDown(e,s))}),p()}if(r&2){let t=i.$implicit,n=i.index,e=m(2);_("otp-input ",e.config.inputClass,""),a("pattern",e.config.allowNumbersOnly?"\\d*":"")("type",e.inputType)("placeholder",(e.config==null?null:e.config.placeholder)||"")("ngStyle",e.config.inputStyles)("formControl",e.otpForm.controls[t])("id",e.getBoxId(n))}}function ft(r,i){if(r&1&&(f(0,"div",1),I(1,ut,2,9,"input",2),E(2,"keys"),p()),r&2){let t=m();_("ng-otp-input-wrapper wrapper ",t.config.containerClass,""),T("id","c_",t.componentKey,""),a("ngStyle",t.config.containerStyles),h(),a("ngForOf",P(2,6,t.otpForm==null?null:t.otpForm.controls))}}var c=class{static ifTab(i){return this.ifKey(i,"Tab")}static ifDelete(i){return this.ifKey(i,"Delete;Del")}static ifBackspace(i){return this.ifKey(i,"Backspace")}static ifRightArrow(i){return this.ifKey(i,"ArrowRight;Right")}static ifLeftArrow(i){return this.ifKey(i,"ArrowLeft;Left")}static ifSpacebar(i){return this.ifKey(i,"Spacebar; ")}static ifKey(i,t){return t.split(";").some(e=>e===i.key)}},x=(()=>{class r{transform(t){return Object.keys(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275pipe=O({name:"keys",type:r,pure:!0}),r})(),st=(()=>{class r{constructor(t,n){this.keysPipe=t,this.document=n,this.config={length:4},this.onInputChange=new V,this.inputControls=new Array(this.config.length),this.componentKey=Math.random().toString(36).substring(2)+new Date().getTime().toString(36)}get inputType(){return this.config?.isPasswordInput?"password":this.config?.allowNumbersOnly?"tel":"text"}ngOnInit(){this.otpForm=new J({});for(let t=0;t<this.config.length;t++)this.otpForm.addControl(this.getControlName(t),new W);this.otpForm.valueChanges.subscribe(t=>{this.keysPipe.transform(this.otpForm.controls).forEach(n=>{var e=this.otpForm.controls[n].value;e&&e.length>1&&(e.length>=this.config.length?this.setValue(e):this.rebuildValue())})})}ngAfterViewInit(){if(!this.config.disableAutoFocus){let t=this.document.getElementById(`c_${this.componentKey}`);if(t){let n=t.getElementsByClassName("otp-input")[0];n&&n.focus&&n.focus()}}}getControlName(t){return`ctrl_${t}`}onKeyDown(t,n){let e=this.getBoxId(n-1),o=this.getBoxId(n);if(c.ifSpacebar(t))return t.preventDefault(),!1;if(c.ifBackspace(t)){t.target.value?this.clearInput(o,n):(this.clearInput(e,n-1),this.setSelected(e)),this.rebuildValue();return}}onInput(t){let n=this.currentVal?`${this.currentVal}${t.target.value}`:t.target.value;if(this.config.allowNumbersOnly&&!this.validateNumber(n)){t.target.value="",t.stopPropagation(),t.preventDefault();return}}onKeyUp(t,n){c.ifTab(t)&&(n-=1);let e=this.getBoxId(n+1),o=this.getBoxId(n-1),s=this.getBoxId(n);if(c.ifRightArrow(t)){t.preventDefault(),this.setSelected(e);return}if(c.ifLeftArrow(t)){t.preventDefault(),this.setSelected(o);return}if(c.ifDelete(t)){t.target.value?this.clearInput(s,n):(this.clearInput(o,n-1),this.setSelected(o)),this.rebuildValue();return}t.target.value&&(this.ifValidKeyCode(t)&&this.setSelected(e),this.rebuildValue())}validateNumber(t){return t&&/^[0-9]+$/.test(t)}getBoxId(t){return`otp_${t}_${this.componentKey}`}clearInput(t,n){let e=this.getControlName(n);this.otpForm.controls[e]?.setValue(null);let o=this.document.getElementById(t);o&&o instanceof HTMLInputElement&&(o.value=null)}setSelected(t){this.focusTo(t);let n=this.document.getElementById(t);n&&n.setSelectionRange&&setTimeout(()=>{n.setSelectionRange(0,1)},0)}ifValidKeyCode(t){let n=t.key;return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||/[a-zA-Z0-9-_]/.test(n)}focusTo(t){let n=this.document.getElementById(t);n&&n.focus()}setValue(t){if(!(this.config.allowNumbersOnly&&isNaN(t))){if(this.otpForm.reset(),!t){this.rebuildValue();return}if(t=t.toString().replace(/\s/g,""),Array.from(t).forEach((e,o)=>{this.otpForm.get(this.getControlName(o))&&this.otpForm.get(this.getControlName(o)).setValue(e)}),!this.config.disableAutoFocus){let e=this.document.getElementById(`c_${this.componentKey}`);var n=t.length<this.config.length?t.length:this.config.length-1;let o=e.getElementsByClassName("otp-input")[n];o&&o.focus&&o.focus()}this.rebuildValue()}}rebuildValue(){let t="";this.keysPipe.transform(this.otpForm.controls).forEach(n=>{if(this.otpForm.controls[n].value){let e=this.otpForm.controls[n].value,o=e.length>1,s=!this.config.allowNumbersOnly&&this.config.letterCase&&(this.config.letterCase.toLocaleLowerCase()=="upper"||this.config.letterCase.toLocaleLowerCase()=="lower");e=e[0];let l=s?this.config.letterCase.toLocaleLowerCase()=="upper"?e.toUpperCase():e.toLowerCase():e;s&&l==e?s=!1:e=l,t+=e,(o||s)&&this.otpForm.controls[n].setValue(e)}}),this.formCtrl?.setValue&&this.formCtrl.setValue(t),this.onInputChange.emit(t),this.currentVal=t}handlePaste(t){let n=t.clipboardData||window.clipboardData;if(n)var e=n.getData("Text");t.stopPropagation(),t.preventDefault(),!(!e||this.config.allowNumbersOnly&&!this.validateNumber(e))&&this.setValue(e)}}return r.\u0275fac=function(t){return new(t||r)(u(x),u(L))},r.\u0275cmp=y({type:r,selectors:[["ng-otp-input"]],inputs:{config:"config",formCtrl:"formCtrl"},outputs:{onInputChange:"onInputChange"},decls:1,vars:1,consts:[[3,"class","id","ngStyle",4,"ngIf"],[3,"id","ngStyle"],["autocomplete","one-time-code",3,"pattern","type","placeholder","ngStyle","class","formControl","id","paste","keyup","input","keydown",4,"ngFor","ngForOf"],["autocomplete","one-time-code",3,"pattern","type","placeholder","ngStyle","formControl","id","paste","keyup","input","keydown"],["inp",""]],template:function(t,n){t&1&&I(0,ft,3,8,"div",0),t&2&&a("ngIf",n.otpForm==null?null:n.otpForm.controls)},dependencies:[R,z,j,H,Y,Z,X,x],styles:[".otp-input[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:4px;border:solid 1px #c5c5c5;text-align:center;font-size:32px}.ng-otp-input-wrapper[_ngcontent-%COMP%]   .otp-input[_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media screen and (max-width: 767px){.otp-input[_ngcontent-%COMP%]{width:40px;font-size:24px;height:40px}}@media screen and (max-width: 420px){.otp-input[_ngcontent-%COMP%]{width:30px;font-size:18px;height:30px}}"]}),r})(),lt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=b({type:r}),r.\u0275inj=N({providers:[x],imports:[[q,$,tt]]}),r})();var v=at(pt());var dt=["ngOtpInput"],gt=()=>({length:6,allowNumbersOnly:!0}),Pt=(()=>{let i=class i{constructor(n,e,o){this._sanitizer=n,this.authService=e,this.router=o,this.showOtpComponent=!0,this.config={allowNumbersOnly:!0,length:4,isPasswordInput:!1,disableAutoFocus:!1,placeholder:"*",inputStyles:{width:"50px",height:"50px"}},this.qrCode=e.qrCode,console.log(e.currentUser())}onOtpChange(n){n.length===6&&this.authService.qrCodeAuth(1,n).subscribe({next:e=>{console.log("/",e),e.ok?this.router.navigate(["/"]):(v.default.fire("Error","Token no valido","error"),this.ngOtpInputRef.setValue(""))},error:e=>{console.log("login error: ",e),v.default.fire("Error",e,"error")}})}pasar(n){n.length===6&&(console.log("onOtpChange == 6"),localStorage.setItem("token",this.authService.token()),this.router.navigate(["/catalogos"]))}};i.\u0275fac=function(e){return new(e||i)(u(U),u(G),u(Q))},i.\u0275cmp=y({type:i,selectors:[["app-two-fa"]],viewQuery:function(e,o){if(e&1&&A(dt,5),e&2){let s;K(s=B())&&(o.ngOtpInputRef=s.first)}},standalone:!0,features:[k],decls:12,vars:3,consts:[[1,"flex","justify-content-center","flex-wrap","mt-6"],[1,"flex","align-items-center","justify-content-center","w-4rem","h-4rem","bg-primary","font-bold","border-round","m-2"],[3,"src"],[3,"config","onInputChange"],["ngOtpInput",""]],template:function(e,o){e&1&&(f(0,"mat-card")(1,"mat-card-content")(2,"h2")(3,"mat-icon"),w(4,"key_vertical"),p(),w(5," C\xF3digo de seguridad"),p(),f(6,"div",0)(7,"div",1),M(8,"img",2),p()(),f(9,"div",0)(10,"ng-otp-input",3,4),C("onInputChange",function(l){return o.pasar(l)}),p()()()()),e&2&&(h(8),a("src",o.qrCode,F),h(2),a("config",D(2,gt)))},dependencies:[nt,et,rt,it,ot,lt,st]});let r=i;return r})();export{Pt as default};
