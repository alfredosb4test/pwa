import{q as g}from"./chunk-I6AKDVZX.js";import{Ta as n,U as l,Ua as a,Y as m,ba as f,j as i,k as h,n as p,z as u}from"./chunk-QYKYBBAS.js";var c=function(t){return t.checking="checking",t.authenticated="authenticated",t.notAuthenticated="notAuthenticated",t}(c||{});var d={baseURL:"http://localhost:3000",asecamURL:"https://www.asecam.com.mx"};var y=(()=>{let r=class r{constructor(o){this.http=o,this.baseURL=d.baseURL,this._currentUser=a(null),this._authStatus=a(c.checking),this._token=a(""),this.currentUser=n(()=>this._currentUser()),this.authStatus=n(()=>this._authStatus()),this.token=n(()=>this._token())}login(o,s){return this.http.post(`${this.baseURL}/api/signup`,{email:o,password:s}).pipe(l(({user:e,qrCode:k,token:U})=>{this._currentUser.set(e),this._authStatus.set(c.authenticated),this._token.set(U),this.qrCode=k}),p(()=>!0),u(e=>h(()=>e.error.message)))}qrCodeAuth(o,s){return this.http.post(`${this.baseURL}/api/twoFA`,{id:o,token:s}).pipe(l(({ok:e})=>(console.log("verifyQrCode",e),e?(localStorage.setItem("token",this.token()),console.log("ok QR"),i(!0)):(console.log("false QR"),localStorage.clear(),i(!1)))),u(e=>(console.log("error qrCodeAuth"),h(()=>e.error.message))))}checkAuthentication(){return localStorage.getItem("token")?i(!0):i(!1)}logout(){this.user=void 0,localStorage.clear()}};r.\u0275fac=function(s){return new(s||r)(f(g))},r.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"});let t=r;return t})();export{y as a};
